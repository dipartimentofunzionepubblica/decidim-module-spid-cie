<%
  available_values = [:s, :m, :l, :xl]
  size = :m if local_assigns[:size].nil? || !available_values.include?(local_assigns[:size])
  url = local_assigns[:url].present? ? local_assigns[:url] : decidim.spid_login_path(sso: { idp: 'idp_key' })
  method = local_assigns[:method].present? ? local_assigns[:method] : :get
  origin = local_assigns[:origin].present? ? local_assigns[:origin] : ''
%>
<div class="text-center">
  <a href="javascript: void(0);" class="italia-it-button italia-it-button-size-<%= size %> button-spid">
    <span class="italia-it-button-icon">
      <%= image_tag 'decidim/spid/spid-ico-circle-bb.svg', onerror: "this.src='spid-ico-circle-bb.png'; this.onerror=null;", alt: "Spid Login" %>
    </span>
    <span class="italia-it-button-text">Entra con SPID</span>
  </a>
  <div class="spid-selector">
    <div class="spid-alert">
      <%= I18n.t('decidim.spid.spid.info_message') %>
      <hr/>
      <div class="spid-disclaimer">
        <%= I18n.t('decidim.spid.spid.disclaimer') %>
        <%= link_to I18n.t('decidim.spid.spid.link'), 'http://www.spid.gov.it/', target: '_blank' %>
      </div>
      <%= image_tag "decidim/spid/spid-agid-logo-lb.svg", alt: "Logo AGID" %>
    </div>
    <div class="spid-container">
      <% list = Decidim::Spid::Idp.all
         list.slice(*list.keys.shuffle).each do |k, p| %>
        <div data-idp="<%= k %>" data-url="">
          <%= form_tag url, method: method do %>
            <%= image_tag "decidim/spid/idp-logos/#{p['logo']}", alt: "#{p['entityName']} Login" %>
            <%= hidden_field_tag "sso[idp]", k %>
            <%= hidden_field_tag "sso[origin]", origin %>
            <%= submit_tag "Submit" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<%= javascript_include_tag "decidim/spid/spid" %>